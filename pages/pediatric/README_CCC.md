# 小兒科住院醫師 CCC 評估系統使用指南

## 📊 圖表邏輯說明

### 1. **訓練完成度並排比較**（長條圖）

**位置**：Tab 1 CCC 總覽 → Section C

**計算邏輯**：
```python
技能完成率 = (已達標技能數 / 16) * 100
  # 已達標 = 該技能的「已完成次數」≥「需完成次數」

EPA達標率 = (EPA平均分 / 5) * 100
  # 將 1-5 分的 EPA 可信賴程度百分化，方便與其他維度並排比較

會議報告均分 = (會議報告五維度平均分 / 5) * 100
  # 將 1-5 分的會議報告評分百分化
```

**門檢標準**：
- Y=60% 虛線：最低期望值（紅燈門檢）
- 低於 60% 的住院醫師會被標記為 🔴 需輔導

**用途**：
- 快速橫向比較所有住院醫師的整體表現
- 一眼看出誰需要關注（低於 60% 虛線的）

---

### 2. **技能完成度熱圖矩陣**

**位置**：Tab 1 CCC 總覽 → Section D

**計算邏輯**：
```python
每個單元格的值 = 已完成次數 / 需完成次數

顏色映射（colorscale）：
  - 紅色（<0.5）：完成不足 50%，嚴重落後
  - 黃色（0.5-0.99）：進行中，尚未達標
  - 綠色（≥1.0）：已達標
  - 深綠（>1.0）：超標完成
```

**排序規則**：
- 住院醫師按整體技能完成率從低到高排序
- **進度慢的排在上面**，方便 CCC 委員優先看到需要關注的人

**單元格標記**：
- 顯示格式：「已完成/需完成」（例：2/3）
- Hover 顯示：住院醫師姓名 + 技能名稱 + 完成情況

**用途**：
- 取代原來的 16 個獨立小圖，資訊密度更高
- 快速定位哪個住院醫師的哪項技能需要加強
- 熱圖的顏色讓問題一目了然

---

### 3. **EPA 信賴程度趨勢圖**（新增）

**位置**：Tab 2 個別深入分析 → Section E（EPA 詳細記錄下方）

**計算邏輯**：
```python
X軸 = 時間（年月，格式：2024-11）
Y軸 = 各 EPA 項目在該月的平均可信賴程度（1-5分）

每條折線 = 一個 EPA 項目（病人日常照護、緊急照護處置、病歷書寫）

計算方式：
  1. 將評核日期按年月分組
  2. 計算每個 EPA 項目在該月的所有評核記錄的平均分
  3. 按時間順序繪製折線
```

**門檢線**：
- 綠色虛線（3.5分）：優秀門檢
- 橙色虛線（2.5分）：及格門檢

**用途**：
- 觀察住院醫師的 EPA 能力是否隨時間進步
- 三條折線可以看出哪個 EPA 項目表現較好/較差
- 趨勢向上 = 進步中，趨勢持平/下降 = 需關注

**解讀範例**：
- 理想情況：三條線都呈上升趨勢，且在 3.5 以上
- 需注意：某條線長期低於 2.5，或呈下降趨勢
- 需輔導：所有線都在 2.5 以下且無明顯上升

---

## 🧪 測試資料說明

### 測試資料集特徵

**檔案位置**：`pages/pediatric/test_data_pediatric_evaluations.csv`

**包含資料**：
- **5位虛擬住院醫師**：
  1. 林盈秀 (R1) - 🟢 優秀（基礎水平 85%）
  2. 游翔皓 (R2) - 🔴 需輔導（基礎水平 45%）
  3. 陳品妤 (R1) - 🟡 需注意（基礎水平 68%）
  4. 張家維 (R3) - 🟢 優秀（基礎水平 92%）
  5. 黃思涵 (R2) - 🔴 需輔導（基礎水平 55%）

- **總評核記錄**：628筆
  - 操作技術：312筆
  - EPA：259筆（每人每月 2-4 筆，覆蓋最近 6 個月）
  - 會議報告：57筆

**資料特點**：
1. **EPA 趨勢**：每位住院醫師的 EPA 分數隨時間遞增（模擬進步）
2. **技能差異化**：優秀者技能完成次數多且可信賴程度高，需輔導者相反
3. **會議報告分數**：與整體水平一致（優秀者 4-5 分，需輔導者 2-3 分）

### 使用測試資料

**方法 1：透過頁面切換**
1. 進入小兒部評核系統
2. 勾選右上角「🧪 使用測試資料」checkbox
3. 系統自動載入測試資料（不調用 Google Sheets API）

**方法 2：重新生成測試資料**
```bash
cd "/Users/mbpr/Library/Mobile Documents/com~apple~CloudDocs/程式開發/Python專案/Python/CBME_python"
python3 generate_pediatric_test_data.py
```

**用途**：
- CCC 會議前的功能演示
- 開發時的快速測試（無需 Google API 權限）
- 培訓新使用者時的範例資料

---

## 🎯 CCC 會議使用流程

### 會議前準備

1. **確認資料載入**
   - 進入「小兒部」頁面
   - 確認 Tab 1 「CCC 總覽」能正常顯示資料
   - 若使用測試資料，勾選「🧪 使用測試資料」

2. **檢視總覽**
   - 警報橫帶：快速識別 🔴 需輔導 / 🟡 需注意 的住院醫師
   - 摘要卡片：確認三個指標（EPA均分 / 技能完成率 / 會議報告均分）
   - 並排長條圖：確認所有人都在 60% 虛線以上
   - 技能熱圖：確認是否有大片紅色區域（技能嚴重落後）

### 會議中使用

**Step 1：從總覽開始**
- 投影 Tab 1「CCC 總覽」
- 說明整體訓練進度
- 點出需要重點討論的住院醫師（紅/黃標記）

**Step 2：逐一深入分析**
- 點擊摘要卡片的「📋 查看詳細分析」按鈕
- 切換到 Tab 2「個別深入分析」
- 檢視三欄儀表盤：
  * 左欄：EPA 雷達圖（與同儕對比）
  * 中欄：技能完成度 + 未達標項目清單
  * 右欄：會議報告雷達圖（與同儕對比）
- 向下捲動看技能分組進度（三組分類）
- 檢視會議報告質性回饋（最近 5 筆）
- **查看 EPA 趨勢圖**：評估是否有進步

**Step 3：記錄決議**
- 根據分析結果，在會議中記錄：
  * 哪些住院醫師需要輔導計畫
  * 哪些技能需要加強訓練
  * 下次 CCC 會議的追蹤重點

### 會議後追蹤

- Tab 3「資料概覽」：查看整體統計數據
- Tab 4「資料管理」：匯出 CSV 備份

---

## 🔧 系統配置

### 門檢標準（硬碼）

位置：`pages/pediatric/pediatric_analysis.py` line 71-77

```python
# 技能完成率門檢（百分比）
THRESHOLD_TECHNICAL_GREEN = 100   # 所有項目均完成
THRESHOLD_TECHNICAL_RED   = 60    # < 60% 為紅燈

# EPA / 會議報告均分門檢（1-5 分制）
THRESHOLD_SCORE_GREEN = 3.5
THRESHOLD_SCORE_RED   = 2.5
```

若需調整，修改以上常數後重啟 Streamlit。

### 技能分組

位置：`pages/pediatric/pediatric_analysis.py` line 63-69

```python
SKILL_GROUPS = {
    '導管與插管類': [8項技能],
    '超音波類': [4項技能],
    '急救與特殊照護類': [4項技能]
}
```

若需調整分組，修改此常數。

---

## 📞 技術支援

**問題排查**：
1. 資料無法載入 → 檢查 Google Sheets 權限
2. 圖表顯示異常 → 嘗試勾選「使用測試資料」排除資料問題
3. EPA 趨勢圖無資料 → 確認 EPA 評核記錄中有「評核日期」欄位

**聯絡資訊**：
- 系統開發：Claude Code (Anthropic)
- 專案路徑：`/Users/mbpr/Library/Mobile Documents/com~apple~CloudDocs/程式開發/Python專案/Python/CBME_python`
