# 學生選擇功能實現說明

## 功能概述

實現了在個別學生雷達圖分析中，根據不同使用者角色提供不同的學生選擇權限：

- **住院醫師、主治醫師、管理員**：可以自由選擇任意學生進行分析
- **學生帳號**：只能查看自己的資料

## 實現細節

### 1. 修改的文件

#### `ugy_radar_analysis.py`
- 修改了 `show_individual_student_radar_analysis()` 函數
- 新增了基於使用者角色的學生選擇邏輯
- 為非學生角色添加了搜尋和選擇功能

#### `new_dashboard.py`
- 修改了 UGY 分頁的顯示邏輯
- 學生帳號只顯示「我的評核資料分析」
- 其他角色顯示完整的「學生總覽」和「個別學生雷達圖分析」分頁

### 2. 核心功能

#### 學生選擇邏輯
```python
# 根據使用者角色決定學生選擇方式
user_role = st.session_state.get('role', None)

if user_role == 'student':
    # 學生帳號只能看到自己的資料
    selected_student = logged_in_user_name
else:
    # 其他角色可以自由選擇學生
    selected_student = st.selectbox("選擇學生", options=filtered_students)
```

#### 搜尋功能
- 為非學生角色提供學生姓名搜尋功能
- 支援模糊搜尋，提高選擇效率

#### 分頁顯示邏輯
```python
if st.session_state.role == 'student':
    # 學生帳號只顯示個別學生雷達圖分析
    st.header("我的評核資料分析")
    show_ugy_radar_analysis()
else:
    # 其他角色顯示完整的分頁
    ugy_subtabs = st.tabs(["學生總覽", "個別學生雷達圖分析"])
```

### 3. 權限控制

#### 現有權限系統
- 使用 `modules/auth.py` 中的權限檢查機制
- 支援角色：`admin`、`teacher`、`resident`、`student`
- 權限設定：`can_view_ugy_data`

#### 權限矩陣
| 角色 | can_view_ugy_data | 學生選擇權限 |
|------|------------------|-------------|
| 管理員 | ✅ | 可選擇任意學生 |
| 主治醫師 | ✅ | 可選擇任意學生 |
| 住院醫師 | ✅ | 可選擇任意學生 |
| 學生 | ✅ | 只能看自己的資料 |

### 4. 使用者體驗

#### 學生帳號
- 自動選擇自己的資料
- 簡潔的介面，只顯示相關功能
- 明確的提示訊息

#### 其他角色
- 提供搜尋功能快速找到目標學生
- 下拉選單顯示所有可選擇的學生
- 顯示選擇的學生資訊

### 5. 測試

#### 測試腳本
- 創建了 `test_student_selection.py` 用於測試功能
- 包含權限矩陣測試
- 模擬不同角色的學生選擇邏輯

#### 測試方法
```bash
streamlit run test_student_selection.py
```

## 使用說明

### 對於學生
1. 登入後進入 UGY 分頁
2. 系統自動顯示「我的評核資料分析」
3. 只能查看自己的雷達圖和評核資料

### 對於住院醫師/主治醫師/管理員
1. 登入後進入 UGY 分頁
2. 選擇「個別學生雷達圖分析」子分頁
3. 使用搜尋功能或下拉選單選擇要分析的學生
4. 查看選定學生的詳細分析資料

## 技術特點

1. **權限控制**：基於現有的權限系統，確保資料安全
2. **使用者體驗**：針對不同角色提供適合的介面
3. **搜尋功能**：提高大量學生資料的選擇效率
4. **向後相容**：不影響現有功能，只是增強了選擇能力
5. **錯誤處理**：包含完整的錯誤檢查和提示訊息

## 未來擴展

1. 可以添加更多搜尋條件（如科別、梯次等）
2. 可以實現批量學生比較功能
3. 可以添加學生資料匯出功能
4. 可以實現更細緻的權限控制（如科別限制）
