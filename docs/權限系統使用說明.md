# 臨床教師評核系統 - 權限管理使用說明

## 系統概述

本系統已實現完整的帳密權限設定功能，根據不同角色提供相應的資料存取權限。

## 角色定義

### 1. 系統管理員 (admin)
- **權限範圍**: 可以查看和管理所有資料
- **功能**: 
  - 查看所有科別的資料
  - 查看所有 UGY、PGY、住院醫師的資料
  - 管理使用者帳號
  - 上傳和管理檔案

### 2. 主治醫師 (teacher)
- **權限範圍**: 可以看到自己科住院醫師的資料，以及所有 UGY、PGY 的資料
- **功能**:
  - 查看自己科的住院醫師資料
  - 查看所有 UGY 資料
  - 查看所有 PGY 資料
  - 上傳檔案
  - 查看分析報告

### 3. 住院醫師 (resident)
- **權限範圍**: 可以看到自己住院醫師的資料，以及所有 UGY 的資料
- **功能**:
  - 查看自己的資料
  - 查看所有 UGY 資料
  - 無法查看 PGY 資料
  - 無法上傳檔案

### 4. UGY (student)
- **權限範圍**: 只能看到自己的資料
- **功能**:
  - 查看自己的評核資料
  - 無法查看其他 UGY 的資料
  - 無法查看 PGY 或住院醫師資料
  - 無法上傳檔案

## 權限設定詳細說明

### 資料存取權限矩陣

| 角色 | 管理員 | 主治醫師 | 住院醫師 | UGY |
|------|--------|----------|----------|-----|
| 全部資料 | ✅ | ❌ | ❌ | ❌ |
| 自己科住院醫師 | ✅ | ✅ | ❌ | ❌ |
| 其他科住院醫師 | ✅ | ❌ | ❌ | ❌ |
| 所有 UGY | ✅ | ✅ | ✅ | ❌ |
| 自己 UGY | ✅ | ✅ | ✅ | ✅ |
| 所有 PGY | ✅ | ✅ | ❌ | ❌ |
| 使用者管理 | ✅ | ❌ | ❌ | ❌ |
| 檔案上傳 | ✅ | ✅ | ❌ | ❌ |

### 科別限制

- **管理員**: 可以選擇和查看所有科別的資料
- **主治醫師**: 只能選擇和查看自己科的資料
- **住院醫師**: 只能查看自己科的資料
- **UGY**: 只能查看自己的資料

## 使用流程

### 1. 帳號申請
1. 在登入頁面選擇「申請帳號」
2. 填寫基本資訊：
   - 使用者名稱
   - 密碼
   - 姓名
   - 科別
   - 分機號碼（可選）
   - 電子郵件（可選）
   - 學號（UGY 必填）

### 2. 帳號審核
- 管理員可以在「使用者管理」→「帳號審核」中審核申請
- 審核通過後，申請者即可登入系統

### 3. 登入系統
1. 輸入使用者名稱和密碼
2. 系統會根據角色顯示相應的功能選單
3. 根據權限限制可選擇的科別和查看的資料

### 4. 資料查看
- 系統會自動根據使用者角色過濾顯示的資料
- 不同角色會看到不同的分頁和功能

## 技術實現

### 權限檢查機制
- 使用 `check_permission()` 函數檢查基本權限
- 使用 `check_data_access_permission()` 函數檢查資料存取權限
- 使用 `filter_data_by_permission()` 函數過濾資料

### 資料過濾
- 在顯示資料前，系統會根據使用者角色和科別自動過濾資料
- 確保使用者只能看到有權限的資料

### 科別管理
- 每個使用者都會被分配到特定科別
- 科別資訊用於限制資料存取範圍

## 安全特性

1. **密碼加密**: 使用 SHA-256 雜湊加密儲存密碼
2. **權限驗證**: 每次資料存取都會進行權限檢查
3. **資料過濾**: 在應用層面過濾資料，確保安全性
4. **會話管理**: 登出時清除所有會話資訊

## 故障排除

### 常見問題

1. **無法登入**
   - 檢查使用者名稱和密碼是否正確
   - 確認帳號是否已通過審核

2. **看不到某些資料**
   - 檢查使用者角色和科別設定
   - 確認是否有相應的資料存取權限

3. **無法上傳檔案**
   - 確認使用者角色是否有上傳權限
   - 檢查科別設定是否正確

### 聯絡方式
如有問題，請聯繫系統管理員。

---

**注意**: 本系統的權限設定已根據您的需求進行配置，確保不同角色只能存取相應的資料範圍。
