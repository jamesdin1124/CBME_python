# UGY 老師分析功能說明

## 功能概述

在UGY模組中新增了「老師分析」分頁，提供以下三個主要功能：

1. **老師評核次數排行榜**
2. **老師評核分數Outlier分析**
3. **老師回饋品質分析**

## 功能詳細說明

### 1. 老師評核次數排行榜

#### 功能特點：
- 統計每位老師的評核次數
- 計算每位老師的平均評核分數
- 顯示每位老師評核的學生數量
- 提供分數統計資訊（標準差、最低分、最高分）

#### 顯示內容：
- 統計摘要（總老師數、總評核次數、平均評核次數、最高評核次數）
- 排行榜表格（按評核次數排序）
- 前20名老師評核次數分佈圖
- 老師評核次數 vs 平均分數關係散點圖

### 2. 老師評核分數Outlier分析

#### 檢測方法：
- **IQR方法（四分位距）**：基於四分位距檢測異常值
- **Z-Score方法（標準分數）**：基於標準分數檢測異常值
- **兩種方法比較**：同時顯示兩種方法的結果

#### 分析內容：
- 每位老師的評核分數統計
- Outlier數量和比例
- 需要關注的老師列表（Outlier數≥3且比例≥20%）
- 視覺化圖表展示

### 3. 老師回饋品質分析

#### 分析維度：
- **回饋長度**：分析回饋內容的詳細程度
- **回饋完整性**：檢查回饋欄位的填寫情況
- **回饋品質**：評估回饋內容的建設性和具體性

#### 品質評分標準：
- **長度評分 (0-40分)**：
  - ≥100字：40分（詳細）
  - 50-99字：25分（中等）
  - 20-49字：15分（簡短）
  - <20字：5分（過於簡陋）

- **內容豐富度 (0-30分)**：
  - 3個以上回饋欄位：30分（完整）
  - 2個回饋欄位：20分（部分完整）
  - 1個回饋欄位：10分（不完整）

- **內容品質 (0-30分)**：
  - 包含具體建議和建設性回饋：30分
  - 包含部分具體建議：20分
  - 缺乏具體建議：10分

#### 品質等級分類：
- **優秀**：80-100分
- **良好**：60-79分
- **一般**：40-59分
- **簡陋**：0-39分

#### 顯示內容：
- 回饋品質等級分佈圖
- 回饋完整的老師名單（優秀等級）
- 回饋過於簡陋的老師名單（簡陋等級）
- 完整回饋品質排行榜
- 詳細回饋內容展示

## 技術實現

### 檔案結構：
```
pages/ugy/
├── ugy_teacher_analysis.py  # 新增的老師分析模組
├── ugy_overview.py          # 學生總覽
├── ugy_individual.py        # 個別學生分析
└── ugy_peers.py            # 同梯次分析
```

### 主要函數：
- `show_ugy_teacher_analysis()`: 主要分析函數
- `get_teacher_evaluation_data()`: 提取老師評核資料
- `show_teacher_evaluation_ranking()`: 顯示評核次數排行榜
- `show_teacher_score_outlier_analysis()`: 顯示Outlier分析
- `analyze_teacher_feedback_quality()`: 分析老師回饋品質
- `show_teacher_feedback_quality_analysis()`: 顯示回饋品質分析
- `convert_level_to_score()`: 分數格式轉換
- `detect_outliers_iqr()`: IQR方法檢測Outlier
- `detect_outliers_zscore()`: Z-Score方法檢測Outlier

### 導航更新：
- 在 `new_dashboard.py` 中更新了UGY的子分頁
- 新增「老師分析」分頁到導航系統
- 保持與現有分頁的一致性

## 使用方式

1. 登入系統後，選擇「UGY」主分頁
2. 在UGY子分頁中選擇「老師分析」
3. 系統會自動提取並分析老師評核資料
4. 可以查看：
   - 老師評核次數排行榜
   - 老師評核分數Outlier分析
   - 老師回饋品質分析

## 資料需求

系統會自動從現有的評核資料中提取以下欄位：
- **教師欄位**：使用`[教師]`欄位作為老師姓名來源
- **EPA評核分數欄位**：包含「EPA」和「等級」關鍵字的欄位
- **回饋欄位**：包含「回饋」、「評語」、「建議」等關鍵字的欄位
- **學生姓名、梯次、科部等基本資訊**

### 重要修正（2024年12月）
- 修正了老師姓名提取邏輯，現在正確使用`[教師]`欄位
- 之前版本錯誤地將評核等級描述當作老師姓名
- 現在會顯示真實的老師姓名而不是評核描述

## 注意事項

1. 需要先在「學生總覽」頁面載入資料
2. 只有非學生角色的使用者可以看到此分頁
3. Outlier分析需要每位老師至少5次評核記錄
4. 系統會自動識別和轉換各種分數格式

## 更新日期

2024年12月 - 新增老師分析功能
- 老師評核次數排行榜
- 老師評核分數Outlier分析
- 老師回饋品質分析（新增）
